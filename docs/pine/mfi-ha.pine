//@version=6
indicator(title="MFI Heikin-Ashi + SMA", shorttitle="MFI HA+SMA", format=format.price, precision=2, timeframe="", timeframe_gaps=true)

// ----------------------
// Inputs
// ----------------------
length = input.int(title="Length MFI", defval=14, minval=1, maxval=2000)
smaLen = input.int(title="SMA Length", defval=14, minval=1, maxval=2000)

// ----------------------
// MFI
// ----------------------
src = hlc3
mf = ta.mfi(src, length)

// SMA of MFI
mfi_sma = ta.sma(mf, smaLen)

// ----------------------
// Heikin-Ashi calculation for MFI
// ----------------------
var float ha_open = na
ha_close = mf
ha_close := (mf + nz(ha_open, mf)) / 2
ha_open := na(ha_open) ? mf : (nz(ha_open) + nz(ha_close[1])) / 2
ha_high = math.max(math.max(ha_close, ha_open), mf)
ha_low  = math.min(math.min(ha_close, ha_open), mf)

// ----------------------
// Plot Heikin-Ashi as candles
// ----------------------
plotcandle(ha_open, ha_high, ha_low, ha_close, color=ha_close >= ha_open ? color.green : color.red, title="MFI Heikin-Ashi")

// ----------------------
// Plot SMA of MFI
// ----------------------
plot(mfi_sma, "SMA MFI", color=color.yellow, linewidth=1)

// ----------------------
// Levels
// ----------------------
overbought = hline(80, title="Overbought", color=#787B86)
hline(50, "Middle Band", color=color.new(#787B86, 50))
oversold   = hline(20, title="Oversold", color=#787B86)

// ----------------------
// Background fill
// ----------------------
fill(overbought, oversold, color=color.rgb(126, 87, 194, 90), title="Background")
bgcolor(ha_close < mfi_sma ? color.new(color.red, 80) : na)
bgcolor(ha_close > mfi_sma ? color.new(color.green, 80) : na)
